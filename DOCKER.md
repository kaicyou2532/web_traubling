# Docker è¨­å®šã‚¬ã‚¤ãƒ‰

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®Dockerè¨­å®šã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚

## ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
â”œâ”€â”€ Dockerfile              # Next.jsæœ¬ç•ªç”¨
â”œâ”€â”€ Dockerfile.dev          # Next.jsé–‹ç™ºç”¨
â”œâ”€â”€ docker-compose.yml      # ãƒ™ãƒ¼ã‚¹è¨­å®š
â”œâ”€â”€ docker-compose.dev.yml  # é–‹ç™ºç’°å¢ƒç”¨
â”œâ”€â”€ docker-compose.prod.yml # æœ¬ç•ªç’°å¢ƒç”¨
â”œâ”€â”€ docker-make.mk          # Dockeræ“ä½œç”¨Makefile
â”œâ”€â”€ .dockerignore           # ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ç”¨
â”œâ”€â”€ .env.example            # ç’°å¢ƒå¤‰æ•°ä¾‹
â””â”€â”€ backend/
    â”œâ”€â”€ Dockerfile          # Goæœ¬ç•ªç”¨
    â”œâ”€â”€ Dockerfile.dev      # Goé–‹ç™ºç”¨ï¼ˆãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰ï¼‰
    â”œâ”€â”€ .dockerignore       # ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ç”¨
    â”œâ”€â”€ .air.toml           # ãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰è¨­å®š
    â””â”€â”€ .env.example        # ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ç’°å¢ƒå¤‰æ•°ä¾‹
```

## ğŸš€ ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

### 1. åˆå›ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
```bash
# ç’°å¢ƒå¤‰æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ”ãƒ¼
make -f docker-make.mk setup

# ç’°å¢ƒå¤‰æ•°ã‚’ç·¨é›†
vi .env
vi backend/.env
```

### 2. é–‹ç™ºç’°å¢ƒã®èµ·å‹•
```bash
# é–‹ç™ºç’°å¢ƒã‚’èµ·å‹•ï¼ˆãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰æœ‰åŠ¹ï¼‰
make -f docker-make.mk dev

# ãƒ“ãƒ«ãƒ‰ã—ã¦èµ·å‹•
make -f docker-make.mk dev-build
```

### 3. ã‚¢ã‚¯ã‚»ã‚¹

| ã‚µãƒ¼ãƒ“ã‚¹ | URL | èª¬æ˜ |
|---------|-----|------|
| ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ | http://localhost:3000 | Next.js ã‚¢ãƒ—ãƒª |
| ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ | http://localhost:8080 | Go API |
| Adminer | http://localhost:8081 | DBç®¡ç† |
| MailHog | http://localhost:8025 | ãƒ¡ãƒ¼ãƒ«ç¢ºèª |

## ğŸ› ï¸ Docker Compose è¨­å®š

### é–‹ç™ºç’°å¢ƒ (`docker-compose.dev.yml`)

**ç‰¹å¾´:**
- ãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰å¯¾å¿œ
- ãƒœãƒªãƒ¥ãƒ¼ãƒ ãƒã‚¦ãƒ³ãƒˆ
- é–‹ç™ºç”¨ãƒ„ãƒ¼ãƒ«ï¼ˆAdminerã€MailHogï¼‰
- ãƒ‡ãƒãƒƒã‚°ç”¨è¨­å®š

**ã‚µãƒ¼ãƒ“ã‚¹:**
- `db`: PostgreSQL
- `redis`: Redis
- `backend`: Go APIï¼ˆãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰ï¼‰
- `frontend`: Next.jsï¼ˆãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰ï¼‰
- `adminer`: DBç®¡ç†ãƒ„ãƒ¼ãƒ«
- `mailhog`: ãƒ¡ãƒ¼ãƒ«é–‹ç™ºãƒ„ãƒ¼ãƒ«

### æœ¬ç•ªç’°å¢ƒ (`docker-compose.prod.yml`)

**ç‰¹å¾´:**
- æœ€é©åŒ–ã•ã‚ŒãŸãƒ“ãƒ«ãƒ‰
- ãƒªã‚½ãƒ¼ã‚¹åˆ¶é™
- ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
- ãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
- Nginx ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·

**ã‚µãƒ¼ãƒ“ã‚¹:**
- `db`: PostgreSQLï¼ˆãƒªã‚½ãƒ¼ã‚¹åˆ¶é™ä»˜ãï¼‰
- `redis`: Redisï¼ˆãƒªã‚½ãƒ¼ã‚¹åˆ¶é™ä»˜ãï¼‰
- `backend`: Go APIï¼ˆ2ãƒ¬ãƒ—ãƒªã‚«ï¼‰
- `frontend`: Next.jsï¼ˆ2ãƒ¬ãƒ—ãƒªã‚«ï¼‰
- `nginx`: ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·

## ğŸ”§ Dockerfile ã®èª¬æ˜

### Next.js Dockerfile

**æœ¬ç•ªç”¨ (`Dockerfile`)**
- ãƒãƒ«ãƒã‚¹ãƒ†ãƒ¼ã‚¸ãƒ“ãƒ«ãƒ‰
- æœ€é©åŒ–ã•ã‚ŒãŸNode.jsã‚¤ãƒ¡ãƒ¼ã‚¸
- érootãƒ¦ãƒ¼ã‚¶ãƒ¼
- ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯

**é–‹ç™ºç”¨ (`Dockerfile.dev`)**
- ã‚·ãƒ³ãƒ—ãƒ«ãªæ§‹æˆ
- ãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰å¯¾å¿œ
- é–‹ç™ºç”¨ä¾å­˜é–¢ä¿‚

### Go Dockerfile

**æœ¬ç•ªç”¨ (`backend/Dockerfile`)**
- Alpine Linuxãƒ™ãƒ¼ã‚¹
- é™çš„ãƒªãƒ³ã‚¯ãƒã‚¤ãƒŠãƒª
- érootãƒ¦ãƒ¼ã‚¶ãƒ¼
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æœ€é©åŒ–

**é–‹ç™ºç”¨ (`backend/Dockerfile.dev`)**
- Air ã‚’ä½¿ç”¨ã—ãŸãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰
- é–‹ç™ºç”¨è¨­å®š

## ğŸ“‹ ã‚ˆãä½¿ã†ã‚³ãƒãƒ³ãƒ‰

```bash
# é–‹ç™ºç’°å¢ƒ
make -f docker-make.mk dev          # é–‹ç™ºç’°å¢ƒèµ·å‹•
make -f docker-make.mk dev-logs     # ãƒ­ã‚°è¡¨ç¤º
make -f docker-make.mk dev-down     # åœæ­¢

# æœ¬ç•ªç’°å¢ƒ
make -f docker-make.mk prod         # æœ¬ç•ªç’°å¢ƒèµ·å‹•
make -f docker-make.mk prod-logs    # ãƒ­ã‚°è¡¨ç¤º
make -f docker-make.mk prod-down    # åœæ­¢

# ç®¡ç†
make -f docker-make.mk ps           # çŠ¶æ…‹ç¢ºèª
make -f docker-make.mk health       # ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
make -f docker-make.mk clean        # ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—

# å€‹åˆ¥ãƒ­ã‚°ç¢ºèª
make -f docker-make.mk frontend-logs
make -f docker-make.mk backend-logs
make -f docker-make.mk db-logs

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œ
make -f docker-make.mk db-shell     # DBæ¥ç¶š
make -f docker-make.mk db-migrate   # ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

# é–‹ç™ºãƒ„ãƒ¼ãƒ«
make -f docker-make.mk adminer      # Adminerèµ·å‹•
make -f docker-make.mk mailhog      # MailHogèµ·å‹•
```

## ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …

### æœ¬ç•ªç’°å¢ƒ
1. **ç’°å¢ƒå¤‰æ•°**: æ©Ÿå¯†æƒ…å ±ã¯ç’°å¢ƒå¤‰æ•°ã§ç®¡ç†
2. **érootãƒ¦ãƒ¼ã‚¶ãƒ¼**: ã‚³ãƒ³ãƒ†ãƒŠå†…ã§éç‰¹æ¨©ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½¿ç”¨
3. **ãƒªã‚½ãƒ¼ã‚¹åˆ¶é™**: ãƒ¡ãƒ¢ãƒªãƒ»CPUåˆ¶é™ã‚’è¨­å®š
4. **ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯**: ã‚µãƒ¼ãƒ“ã‚¹ç›£è¦–ã‚’å®Ÿè£…

### é–‹ç™ºç’°å¢ƒ
1. **ãƒãƒ¼ãƒˆå…¬é–‹**: å¿…è¦æœ€å°é™ã®ãƒãƒ¼ãƒˆã®ã¿å…¬é–‹
2. **ãƒœãƒªãƒ¥ãƒ¼ãƒ **: æ©Ÿå¯†ãƒ•ã‚¡ã‚¤ãƒ«ã¯ãƒã‚¦ãƒ³ãƒˆã—ãªã„
3. **ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯**: éš”é›¢ã•ã‚ŒãŸãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ä½¿ç”¨

## ğŸ› ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œ

**1. ãƒãƒ¼ãƒˆãŒä½¿ç”¨ä¸­**
```bash
# ãƒãƒ¼ãƒˆä½¿ç”¨çŠ¶æ³ç¢ºèª
lsof -i :3000
lsof -i :8080

# ãƒ—ãƒ­ã‚»ã‚¹åœæ­¢
kill -9 <PID>
```

**2. ãƒœãƒªãƒ¥ãƒ¼ãƒ ã®æ¨©é™å•é¡Œ**
```bash
# æ¨©é™ä¿®æ­£
sudo chown -R $(id -u):$(id -g) .
```

**3. ã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼**
```bash
# ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢
docker system prune -a
docker-compose build --no-cache
```

**4. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã‚¨ãƒ©ãƒ¼**
```bash
# DBçŠ¶æ…‹ç¢ºèª
make -f docker-make.mk db-logs

# DBæ¥ç¶šãƒ†ã‚¹ãƒˆ
make -f docker-make.mk db-shell
```

### ãƒ­ã‚°ã®ç¢ºèªæ–¹æ³•

```bash
# å…¨ã‚µãƒ¼ãƒ“ã‚¹ã®ãƒ­ã‚°
make -f docker-make.mk dev-logs

# ç‰¹å®šã‚µãƒ¼ãƒ“ã‚¹ã®ãƒ­ã‚°
docker-compose -f docker-compose.dev.yml logs -f <service-name>

# ã‚¨ãƒ©ãƒ¼ã®ã¿è¡¨ç¤º
docker-compose -f docker-compose.dev.yml logs --tail=50 | grep -i error
```

## ğŸ”„ é–‹ç™ºãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

### 1. æ–°æ©Ÿèƒ½é–‹ç™º
```bash
# é–‹ç™ºç’°å¢ƒèµ·å‹•
make -f docker-make.mk dev

# ã‚³ãƒ¼ãƒ‰å¤‰æ›´ï¼ˆãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰è‡ªå‹•é©ç”¨ï¼‰

# ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
make -f docker-make.mk test

# ãƒ­ã‚°ç¢ºèª
make -f docker-make.mk dev-logs
```

### 2. æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤å‰ç¢ºèª
```bash
# æœ¬ç•ªç”¨ãƒ“ãƒ«ãƒ‰ãƒ†ã‚¹ãƒˆ
make -f docker-make.mk prod-build

# å‹•ä½œç¢ºèª
make -f docker-make.mk health

# åœæ­¢
make -f docker-make.mk prod-down
```

## ğŸ“ˆ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚µã‚¤ã‚ºå‰Šæ¸›
1. **ãƒãƒ«ãƒã‚¹ãƒ†ãƒ¼ã‚¸ãƒ“ãƒ«ãƒ‰**: ä¸è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ã‚’é™¤å¤–
2. **.dockerignore**: ãƒ“ãƒ«ãƒ‰ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’æœ€å°åŒ–
3. **Alpine Linux**: è»½é‡ãªãƒ™ãƒ¼ã‚¹ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½¿ç”¨

### ãƒ“ãƒ«ãƒ‰æ™‚é–“çŸ­ç¸®
1. **ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚­ãƒ£ãƒƒã‚·ãƒ¥**: å¤‰æ›´é »åº¦ã®ä½ã„ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’å…ˆã«é…ç½®
2. **ä¸¦åˆ—ãƒ“ãƒ«ãƒ‰**: ãƒãƒ«ãƒã‚³ã‚¢ã‚’æ´»ç”¨
3. **ä¾å­˜é–¢ä¿‚ã®åˆ†é›¢**: package.jsonã¨ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’åˆ†é›¢

ã“ã®è¨­å®šã«ã‚ˆã‚Šã€é–‹ç™ºã‹ã‚‰æœ¬ç•ªã¾ã§ä¸€è²«ã—ãŸDockerç’°å¢ƒã‚’æ§‹ç¯‰ã§ãã¾ã™ã€‚
